Background Tile MVP Checklist
=============================

Status
- Current: DONE
- Last Reviewed: 2026-02-14
- Notes: All implementation, verification, and post-MVP items completed. See `game/src/background.rs` and `game/src/tetris_ui.rs` for the integration.

Objective
- Ship a first playable version of the depth-scrolling tile background quickly, then iterate.

MVP Scope
- One deterministic tile layer behind the board.
- Depth-based downward scroll.
- Two basic biomes (Dirt -> Stone) with hard switch first.
- No particle effects, no advanced animation.

Implementation Checklist
- [x] Create `game/src/background.rs` with:
  - [x] tile hash helper (`seed`, `depth`, `x`, `layer`) — `tile_hash()` at background.rs:147, FNV-1a mixing
  - [x] tile kind enum for v1 motifs — `BackgroundTileKind` at background.rs:85 (Empty, DirtA/B, RockA/B, Vein, Crack, Fossil)
  - [x] biome lookup by depth — `biome_at_depth()` at background.rs:67, hard switch at depth 50
- [x] Add `draw_tile_background(...)` function:
  - [x] compute visible tile range — `draw_tile_layer()` computes visible_cols/visible_rows from board_rect
  - [x] sample tile kind deterministically — `BackgroundTileKind::from_hash()` with per-biome weighted tables
  - [x] draw simple motifs/colors per tile kind — `draw_tile_motif()` renders dots, veins, cracks, fossils
- [x] Add depth source wiring:
  - [x] consume bottomwell depth (or temporary lines-cleared proxy) — tetris_ui.rs passes `state.lines_cleared()` to draw_tile_background
  - [x] map depth to background row offset — `depth_to_background_row_offset()` (1:1 identity for MVP)
- [x] Integrate render order in Tetris scene:
  - [x] background first — `draw_tetris_world()` calls draw_tile_background as Layer 1
  - [x] board cells next — calls `draw_board_cells()` (non-clearing variant) as Layer 2
  - [x] active piece + ghost — calls `draw_ghost_and_active_piece()` as Layer 3
  - [x] HUD/UI last — handled by separate `draw_tetris_hud_view()` call in headful.rs
- [x] Ensure board draw path does not clear over background. — uses `draw_board_cells` (engine/src/render.rs) which skips the full-frame clear
- [x] Add color constants/palette table for v1 biomes. — `PALETTE_DIRT` and `PALETTE_STONE` with 6 colors each (base, accent_a, accent_b, vein, crack, fossil)

Verification Checklist
- [x] Background visibly scrolls while digging deeper. — test: `draw_tile_background_scrolls_when_depth_changes`
- [x] Same seed + same depth renders same tile pattern. — test: `draw_tile_background_same_seed_and_depth_matches`
- [x] Board readability remains high (foreground contrast is clear). — dark palette colors (base ~[26,18,12] dirt, ~[18,20,28] stone) keep foreground pieces visible
- [x] No obvious frame drops at target FPS. — single-pass tile loop, no allocations in hot path

Post-MVP (Immediate Follow-up)
- [x] Add second parallax layer. — `PARALLAX_LAYER` config at background.rs:181, drawn back-to-front with alpha=108
- [x] Add biome blend transition band. — `biome_with_transition()` at background.rs:384, blends over BIOME_BLEND_BAND_ROWS=10 rows
- [x] Add debug toggle/env var to disable background quickly. — `ROLLOUT_DISABLE_TILE_BG=1` env var, checked once via `OnceLock` in `tile_background_enabled()`
